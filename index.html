<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Car Catching Projectile Timing Calculator</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f8f9fa; padding: 20px; }
    h1 { text-align: center; }
    .calculator { max-width: 640px; margin: auto; background: #fff; padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    label { display: block; margin-top: 12px; font-weight: bold; }
    select, input, button { width: 100%; padding: 10px; margin-top: 6px; border-radius: 8px; border: 1px solid #ccc; font-size: 14px; }
    .note { font-size: 13px; color: #333; margin-top: 6px; }
    button { background: #007bff; color: white; cursor: pointer; font-weight: bold; }
    button:hover { background: #0056b3; }
    .results { margin-top: 20px; padding: 15px; background: #f1f3f5; border-radius: 8px; font-family: monospace; white-space: pre-line; }
    .highlight { color: green; font-weight: bold; }
    .warning { margin-top: 12px; color: red; font-weight: bold; }
  </style>
</head>
<body>
  <h1>Car Catching Projectile Timing Calculator</h1>
  <div class="calculator">
    <label for="car">Choose car</label>
    <select id="car"></select>

    <label for="launcher">Choose launcher</label>
    <select id="launcher"></select>

    <label for="distance">Distance (m) — car to launcher (must be less than projectile range)</label>
    <input type="number" id="distance" placeholder="Enter distance in meters" step="0.01" value="1.00">

    <div class="note">Note: The car is always assumed to be between the launcher and the landing spot.</div>

    <button onclick="calculate()">Calculate timing</button>

    <div class="results" id="results"></div>
  </div>

  <script>
    const carVelocities = {
      "1": 0.197,
      "2": 0.231,
      "3": 0.283,
      "4": 0.286,
      "5": 0.262,
      "6": 0.376,
      "7": 0.244,
      "8": 0.306,
      "9": 0.301,
      "10": 0.285,
      "MIKEY": 0.44
    };

    const launcherData = {
      "1": { range: 1.63, time: 1.01 },
      "2": { range: 1.3975, time: 1.03025 },
      "3": { range: 1.6067, time: 1.0423 }
    };

    // populate selects
    const carSelect = document.getElementById('car');
    for (const k in carVelocities) {
      const o = document.createElement('option'); o.value = k; o.textContent = k; carSelect.appendChild(o);
    }
    const launcherSelect = document.getElementById('launcher');
    for (const k in launcherData) {
      const o = document.createElement('option'); o.value = k; o.textContent = k; launcherSelect.appendChild(o);
    }

    function calculate() {
      const carKey = carSelect.value;
      const launcherKey = launcherSelect.value;
      const distance = parseFloat(document.getElementById('distance').value);
      const out = document.getElementById('results');

      if (!carKey || !launcherKey || isNaN(distance) || distance < 0) {
        out.textContent = 'Please select car, launcher and enter a valid non-negative distance.'; return;
      }

      const v = carVelocities[carKey];
      const R = launcherData[launcherKey].range;
      const Tproj = launcherData[launcherKey].time;

      if (distance >= R) {
        out.textContent = `Invalid input: Car distance (${distance.toFixed(3)} m) must be less than projectile range (${R.toFixed(3)} m).`;
        return;
      }

      const x0 = distance;
      const travelNeeded = R - x0;

      const carTravelTime = travelNeeded / v;
      let delay = carTravelTime - Tproj;

      // Adjust delay instead of flight time
      let adjustmentNote = "";
      if (launcherKey === "2") { delay -= 0.5; adjustmentNote = "Launcher 2 undershoot → subtracted 0.5s from delay"; }
      if (launcherKey === "3") { delay += 0.5; adjustmentNote = "Launcher 3 overshoot → added 0.5s to delay"; }
      if (launcherKey === "1") { adjustmentNote = "Launcher 1 baseline, no adjustment."; }

      let recommendedDelay = delay >= 0 ? delay : 0;
      const t_land = recommendedDelay + Tproj;
      const carPosAtFire = x0 + v * recommendedDelay;
      const carPosAtLanding = x0 + v * t_land;

      let s = '';
      s += `Equation: delay = (R - x0)/v - T_proj (then adjust based on overshoot/undershoot)\n\n`;
      s += `Car velocity: ${v.toFixed(3)} m/s\n`;
      s += `Distance to launcher: ${distance.toFixed(3)} m\n`;
      s += `Projectile range: ${R.toFixed(3)} m\n`;
      s += `Projectile flight time: ${Tproj.toFixed(3)} s\n`;
      s += `${adjustmentNote}\n\n`;

      s += `<span class="highlight">Fire delay: ${recommendedDelay.toFixed(3)} s</span>\n`;
      s += `<span class="highlight">Car position to fire: ${carPosAtFire.toFixed(3)} m</span>\n`;
      s += `At landing t = ${t_land.toFixed(3)} s → Car at ${carPosAtLanding.toFixed(3)} m, Spot at ${R.toFixed(3)} m\n\n`;

      s += `<div class="warning">⚠ Use intuition after the first launch, DATA WILL NOT BE ACCURATE AS BATTERIES HAVE PROBABLY RUN OUT.</div>`;

      out.innerHTML = s;
    }
  </script>
</body>
</html>
